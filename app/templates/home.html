{% extends 'layout.html' %}
{% block page_content %}
<div class="max-w-2xl mx-auto mt-6 sm:mt-10 p-4 sm:p-6 bg-slate-100 dark:bg-slate-800 shadow-xl rounded-lg">
  {% if session.user_id %} 
    <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
      <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-0 text-center text-slate-800 dark:text-slate-100">
        {% if plex_event and plex_event.event and plex_event.event != 0 %}
          {{ plex_event.event | title }} 
        {% else %}
          ShowNotes Home
        {% endif %}
      </h2>
    </div>

    {% if plex_event and plex_event.Metadata %}
      <div class="bg-slate-100 dark:bg-slate-800 shadow-xl rounded-lg p-4 sm:p-6 flex flex-col sm:flex-row items-start gap-4 sm:gap-6 mb-6">
        {% if poster_url %}
          <img class="w-24 sm:w-32 h-36 sm:h-48 object-cover rounded-md border border-slate-300 dark:border-slate-700 shadow-sm" src="{{ poster_url }}" alt="Show poster">
        {% endif %}
        <div class="flex-1">
          <h3 class="text-xl sm:text-2xl font-bold text-slate-800 dark:text-slate-100 mb-1 sm:mb-2">{{ plex_event.Metadata.grandparentTitle or plex_event.Metadata.title }}</h3>
          {% if plex_event.Metadata.type == 'episode' %}
            <div class="text-md sm:text-lg font-semibold text-slate-700 dark:text-slate-200 mb-1">
              Season {{ plex_event.Metadata.parentIndex }}, Episode {{ plex_event.Metadata.index }}: {{ plex_event.Metadata.title }}
            </div>
          {% endif %}
          {% if plex_event.Metadata.summary %}
            <p class="text-sm sm:text-base text-slate-600 dark:text-slate-300 mb-2">{{ plex_event.Metadata.summary }}</p>
          {% endif %}
          {% if plex_event.Account %}
            <p class="text-sm text-slate-500 dark:text-slate-400">User: {{ plex_event.Account.title }}</p>
          {% endif %}
          <p class="text-xs text-slate-400 dark:text-slate-500 mt-2">(Most recent event received from Plex)</p>
        </div>
      </div>
    {% else %}
      <div class="bg-slate-100 dark:bg-slate-800 shadow-xl rounded-lg p-6 mb-6 text-slate-600 dark:text-slate-300 text-center">
        <p>No recent Plex activity found for your account, or still waiting for the first webhook event.</p>
        <p class="mt-2 text-sm">Try playing something on Plex!</p>
      </div>
    {% endif %}
  {% else %} 
    <div class="text-center py-10">
      <h2 class="text-3xl sm:text-4xl font-bold text-slate-800 dark:text-slate-100 mb-4">
        ShowNotes
      </h2>
      <p class="text-xl sm:text-2xl text-slate-600 dark:text-slate-300 mb-8">
        The Ultimate Companion for Your Plex Experience.
      </p>
      <a href="{{ url_for('main.login') }}" 
         class="px-6 py-3 bg-sky-500 hover:bg-sky-600 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out text-lg">
        Sign in with Plex
      </a>
    </div>
  {% endif %}
</div>{% endblock page_content %}
