{% extends "layout.html" %}
{% block page_title %}Login{% endblock %}
{% block page_content %}
<h2 class="text-xl font-bold mb-4">Login</h2>
<button id="plex-login" class="bg-blue-500 text-white px-4 py-2">Sign in with Plex</button>
<p id="login_status" class="mt-2"></p>
<script>
document.getElementById('plex-login').addEventListener('click', async () => {
  const resp = await fetch('/login/plex/start');
  const data = await resp.json();
  window.open(data.authUrl, '_blank');
  async function poll(){
    const r = await fetch('/login/plex/poll');
    const p = await r.json();
    if(p.authorized){
      document.getElementById('login_status').textContent = 'Logged in!';
      window.location = '/';
    } else {
      setTimeout(poll, 2000);
    }
  }
  poll();
});
</script>
{% endblock %}
