{% extends "layout.html" %}
{% block page_title %}Service Setup{% endblock %}
{% block search_bar %}{% endblock %}

{% block page_content %}
<div class="max-w-lg mx-auto mt-8 sm:mt-12 mb-8">
  <div class="bg-slate-100 dark:bg-slate-800 shadow-xl rounded-lg p-6 sm:p-8">
    <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100 mb-2 text-center">Step 2 of 2: Configure Services</h2>
    <p class="text-sm text-slate-600 dark:text-slate-400 mb-6 text-center">All fields are optional - you can configure them later in Admin > Settings</p>
    <form method="post" id="services-form" class="space-y-5 sm:space-y-6">
      <div>
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="base_url">Base URL (e.g., http://your-server)</label>
        <input type="text" id="base_url" name="base_url" placeholder="http://192.168.1.100 or https://example.com" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.base_url if env_settings else '' }}">
        <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">Enter your main server address. Service URLs below will be auto-filled with default ports.</p>
      </div>

      <!-- Radarr -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Radarr</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="radarr_url">Radarr Local URL</label>
            <input type="text" id="radarr_url" name="radarr_url" placeholder="http://192.168.1.100:7878" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.radarr_url if env_settings else '' }}">
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">Local network URL for API access</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="radarr_remote_url">Radarr Remote URL (Optional)</label>
            <input type="text" id="radarr_remote_url" name="radarr_remote_url" placeholder="https://radarr.yourdomain.com" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.radarr_remote_url if env_settings else '' }}">
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">External URL for user links (via Cloudflare/reverse proxy)</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="radarr_api_key">Radarr API Key</label>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
              <input type="text" id="radarr_api_key" name="radarr_api_key" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.radarr_api_key if env_settings else '' }}">
            </div>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end mt-2">
              <button type="button" data-service="radarr" class="test-btn w-full sm:w-auto flex justify-center bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-md shadow-sm text-sm font-medium whitespace-nowrap">Test</button>
            </div>
            <span id="radarr_status" class="ml-2 text-xs"></span>
          </div>
        </div>
      </fieldset>

      <!-- Sonarr -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Sonarr (Optional)</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="sonarr_url">Sonarr Local URL</label>
            <input type="text" id="sonarr_url" name="sonarr_url" placeholder="http://192.168.1.100:8989" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.sonarr_url if env_settings else '' }}">
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">Local network URL for API access</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="sonarr_remote_url">Sonarr Remote URL (Optional)</label>
            <input type="text" id="sonarr_remote_url" name="sonarr_remote_url" placeholder="https://sonarr.yourdomain.com" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.sonarr_remote_url if env_settings else '' }}">
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">External URL for user links (via Cloudflare/reverse proxy)</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="sonarr_api_key">Sonarr API Key</label>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
              <input type="text" id="sonarr_api_key" name="sonarr_api_key" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.sonarr_api_key if env_settings else '' }}">
            </div>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end mt-2">
              <button type="button" data-service="sonarr" class="test-btn w-full sm:w-auto flex justify-center bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-md shadow-sm text-sm font-medium whitespace-nowrap">Test</button>
            </div>
            <span id="sonarr_status" class="ml-2 text-xs"></span>
          </div>
        </div>
      </fieldset>

      <!-- Bazarr -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Bazarr (Optional)</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="bazarr_url">Bazarr URL</label>
            <input type="text" id="bazarr_url" name="bazarr_url" placeholder="http://192.168.1.100:6767" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.bazarr_url if env_settings else '' }}">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="bazarr_api_key">Bazarr API Key</label>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
              <input type="text" id="bazarr_api_key" name="bazarr_api_key" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.bazarr_api_key if env_settings else '' }}">
            </div>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end mt-2">
              <button type="button" data-service="bazarr" class="test-btn w-full sm:w-auto flex justify-center bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-md shadow-sm text-sm font-medium whitespace-nowrap">Test</button>
            </div>
            <span id="bazarr_status" class="ml-2 text-xs"></span>
          </div>
        </div>
      </fieldset>

      <!-- Tautulli -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Tautulli (Optional)</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="tautulli_url">Tautulli URL</label>
            <input type="text" id="tautulli_url" name="tautulli_url" placeholder="http://192.168.1.100:8181" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.tautulli_url if env_settings else '' }}">
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">For importing watch history from Plex</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="tautulli_api_key">Tautulli API Key</label>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
              <input type="text" id="tautulli_api_key" name="tautulli_api_key" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.tautulli_api_key if env_settings else '' }}">
            </div>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end mt-2">
              <button type="button" data-service="tautulli" class="test-btn w-full sm:w-auto flex justify-center bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-md shadow-sm text-sm font-medium whitespace-nowrap">Test</button>
            </div>
            <span id="tautulli_status" class="ml-2 text-xs"></span>
          </div>
        </div>
      </fieldset>

      <!-- Jellyseer -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Jellyseer (Optional)</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="jellyseer_url">Jellyseer URL</label>
            <input type="text" id="jellyseer_url" name="jellyseer_url" placeholder="http://192.168.1.100:5055" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.jellyseer_url if env_settings else '' }}">
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">For requesting content</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="jellyseer_api_key">Jellyseer API Key</label>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
              <input type="text" id="jellyseer_api_key" name="jellyseer_api_key" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.jellyseer_api_key if env_settings else '' }}">
            </div>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end mt-2">
              <button type="button" data-service="jellyseer" class="test-btn w-full sm:w-auto flex justify-center bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-md shadow-sm text-sm font-medium whitespace-nowrap">Test</button>
            </div>
            <span id="jellyseer_status" class="ml-2 text-xs"></span>
          </div>
        </div>
      </fieldset>

      <!-- Ollama -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Ollama (Optional)</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="ollama_url">Ollama URL</label>
            <div class="flex items-center space-x-2">
              <input type="text" id="ollama_url" name="ollama_url" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.ollama_url if env_settings else '' }}">
              <button type="button" data-service="ollama" class="test-btn bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-md shadow-sm text-sm font-medium whitespace-nowrap">Test</button>
            </div>
            <span id="ollama_status" class="ml-2 text-xs"></span>
          </div>
        </div>
      </fieldset>

      <!-- Pushover -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Pushover (Optional)</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="pushover_key">Pushover User Key</label>
            <input type="text" id="pushover_key" name="pushover_key" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.pushover_key if env_settings else '' }}">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="pushover_token">Pushover API Token</label>
            <input type="text" id="pushover_token" name="pushover_token" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.pushover_token if env_settings else '' }}">
          </div>
          <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end mt-2">
            <button type="button" data-service="pushover" class="test-btn w-full sm:w-auto flex justify-center bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-md shadow-sm text-sm font-medium whitespace-nowrap">Test</button>
          </div>
          <span id="pushover_status" class="ml-2 text-xs"></span>
        </div>
      </fieldset>

      <!-- Plex Client ID -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Plex OAuth (Optional)</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="plex_client_id">Plex Client ID</label>
            <input type="text" id="plex_client_id" name="plex_client_id" placeholder="shownotes-yourname" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="{{ env_settings.plex_client_id if env_settings else '' }}">
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">For Plex OAuth login - can be any unique identifier (e.g., "shownotes-yourname")</p>
          </div>
        </div>
      </fieldset>

      <!-- Timezone Selection -->
      <fieldset class="border border-slate-300 dark:border-slate-700 rounded-lg p-4 pt-2">
        <legend class="text-sm font-medium text-slate-600 dark:text-slate-300 px-2">Timezone</legend>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="timezone">Your Timezone</label>
            <select id="timezone" name="timezone" class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2.5 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
              <option value="">Auto-detect from browser</option>
              <optgroup label="North America">
                <option value="America/New_York">Eastern Time (ET)</option>
                <option value="America/Chicago">Central Time (CT)</option>
                <option value="America/Denver">Mountain Time (MT)</option>
                <option value="America/Phoenix">Arizona (MST)</option>
                <option value="America/Regina">Saskatchewan (CST - no DST)</option>
                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                <option value="America/Anchorage">Alaska Time (AKT)</option>
                <option value="Pacific/Honolulu">Hawaii Time (HST)</option>
              </optgroup>
              <optgroup label="Europe">
                <option value="Europe/London">London (GMT/BST)</option>
                <option value="Europe/Paris">Paris (CET/CEST)</option>
                <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                <option value="Europe/Rome">Rome (CET/CEST)</option>
                <option value="Europe/Athens">Athens (EET/EEST)</option>
                <option value="Europe/Moscow">Moscow (MSK)</option>
              </optgroup>
              <optgroup label="Asia">
                <option value="Asia/Dubai">Dubai (GST)</option>
                <option value="Asia/Kolkata">India (IST)</option>
                <option value="Asia/Singapore">Singapore (SGT)</option>
                <option value="Asia/Tokyo">Tokyo (JST)</option>
                <option value="Asia/Shanghai">China (CST)</option>
                <option value="Asia/Seoul">Seoul (KST)</option>
              </optgroup>
              <optgroup label="Australia">
                <option value="Australia/Sydney">Sydney (AEDT/AEST)</option>
                <option value="Australia/Melbourne">Melbourne (AEDT/AEST)</option>
                <option value="Australia/Brisbane">Brisbane (AEST)</option>
                <option value="Australia/Perth">Perth (AWST)</option>
              </optgroup>
              <optgroup label="Other">
                <option value="UTC">UTC</option>
              </optgroup>
            </select>
            <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">Used for displaying air times and activity timestamps</p>
          </div>
        </div>
      </fieldset>

      <!-- Info box about what happens next -->
      <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mt-6">
        <h3 class="text-sm font-semibold text-blue-900 dark:text-blue-200 mb-2">üìù What happens next:</h3>
        <ul class="text-sm text-blue-800 dark:text-blue-300 space-y-1 list-disc list-inside">
          <li>You'll be redirected to the login page</li>
          <li>Log in with your admin credentials</li>
          <li>Optional: Link your Plex account in Admin > Settings for OAuth login</li>
          <li>Use Admin > Tasks to sync your Sonarr/Radarr libraries</li>
          <li>Use Admin > Tasks > "Wipe & Fresh Import" to import Tautulli history</li>
        </ul>
        <p class="mt-3 text-xs text-blue-700 dark:text-blue-400">
          üí° Tip: You can skip filling out the services now and configure them later in Admin > Settings
        </p>
      </div>

      <div class="flex justify-end mt-6">
        <button type="submit" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-sky-500 hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 dark:ring-offset-slate-800">
          Finish Setup
        </button>
      </div>
    </form>
  </div>
</div>
  <script src="{{ url_for('static', filename='onboarding_services.js') }}"></script>
{% endblock %}
