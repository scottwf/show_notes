{% extends "profile_base.html" %}

{% block profile_content %}
<div>
    <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6">Favorite Shows</h2>

    {% if favorites %}
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
        {% for show in favorites %}
        <div class="group relative">
            <a href="{{ show.detail_url }}" class="block">
                <img src="{{ show.cached_poster_url }}" alt="{{ show.title }}"
                    class="w-full aspect-[2/3] object-cover rounded-lg shadow-md group-hover:shadow-xl transition-shadow"
                    onerror="this.src='{{ url_for('static', filename='logos/placeholder_poster.png') }}';">

                <!-- Remove favorite button -->
                <button onclick="removeFavorite(event, {{ show.show_db_id }})"
                    class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white rounded-full p-2 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity"
                    title="Remove from favorites">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
            </a>

            <div class="mt-2">
                <h3 class="font-semibold text-sm text-slate-800 dark:text-slate-100 truncate">
                    <a href="{{ show.detail_url }}" class="hover:text-sky-600 dark:hover:text-sky-400">
                        {{ show.title }}
                    </a>
                </h3>
                <p class="text-xs text-slate-600 dark:text-slate-400">
                    {% if show.year %}{{ show.year }} â€¢ {% endif %}{{ show.status | title }}
                </p>
                {% if show.formatted_added_date %}
                <p class="text-xs text-slate-500 dark:text-slate-500 mt-1">Added {{ show.formatted_added_date }}</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12">
        <svg class="w-16 h-16 mx-auto text-slate-400 dark:text-slate-600 mb-4" fill="none" stroke="currentColor"
            viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z">
            </path>
        </svg>
        <h3 class="text-lg font-semibold text-slate-700 dark:text-slate-300 mb-2">No favorites yet</h3>
        <p class="text-slate-600 dark:text-slate-400 mb-4">Start favoriting shows to keep track of them here!</p>
        <a href="{{ url_for('main.home') }}"
            class="inline-block px-6 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition-colors">
            Browse Shows
        </a>
    </div>
    {% endif %}
</div>

<script>
    async function removeFavorite(event, showId) {
        event.preventDefault();
        event.stopPropagation();

        if (!confirm('Remove this show from your favorites?')) {
            return;
        }

        try {
            const response = await fetch(`/api/profile/favorite/${showId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            const data = await response.json();

            if (data.success) {
                // Reload the page to update the list
                window.location.reload();
            } else {
                alert('Failed to remove favorite: ' + (data.error || 'Unknown error'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Failed to remove favorite. Please try again.');
        }
    }
</script>
{% endblock %}