{% extends "admin_layout.html" %}

{% block admin_page_content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 text-gray-800 dark:text-gray-200">Tasks & Synchronization</h1>

    <!-- Sonarr Sync Card -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mb-6 border border-transparent dark:border-gray-700">
        <div class="flex items-center mb-4">
            <img src="{{ url_for('static', filename='logos/sonarr-light.png') }}" alt="Sonarr Logo" class="block dark:hidden h-8 w-auto mr-3">
            <img src="{{ url_for('static', filename='logos/sonarr-dark.png') }}" alt="Sonarr Logo" class="hidden dark:block h-8 w-auto mr-3">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">Sonarr Library</h2>
        </div>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
            Manually trigger a synchronization of your Sonarr library. This will fetch all shows, seasons, and episodes, and pre-cache poster images. This process might take some time.
            <br><br>
            <span class="text-blue-600 dark:text-blue-400 text-sm">ðŸ’¡ <strong>Tip:</strong> You can set up automatic syncing via webhooks in the <a href="{{ url_for('admin.settings') }}" class="underline">Settings</a> page to eliminate the need for manual syncing.</span>
        </p>
        <form action="{{ url_for('admin.sync_sonarr') }}" method="POST">
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transform transition-all duration-200 ease-in-out flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0015.357 2M9 15h4.581" />
                </svg>
                Sync Sonarr Library
            </button>
        </form>
    </div>

    <!-- Radarr Sync Card -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mb-6 border border-transparent dark:border-gray-700">
        <div class="flex items-center mb-4">
            <img src="{{ url_for('static', filename='logos/radarr-light.png') }}" alt="Radarr Logo" class="block dark:hidden h-8 w-auto mr-3">
            <img src="{{ url_for('static', filename='logos/radarr-dark.png') }}" alt="Radarr Logo" class="hidden dark:block h-8 w-auto mr-3">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">Radarr Library</h2>
        </div>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
            Manually trigger a synchronization of your Radarr library. This will fetch all movies and pre-cache poster and fanart images. This process might take some time.
            <br><br>
            <span class="text-green-600 dark:text-green-400 text-sm">ðŸ’¡ <strong>Tip:</strong> You can set up automatic syncing via webhooks in the <a href="{{ url_for('admin.settings') }}" class="underline">Settings</a> page to eliminate the need for manual syncing.</span>
        </p>
        <form action="{{ url_for('admin.sync_radarr') }}" method="POST">
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transform transition-all duration-200 ease-in-out flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0015.357 2M9 15h4.581" />
                </svg>
                Sync Radarr Library
            </button>
        </form>
    </div>

    <!-- Placeholder for other future tasks -->
    <!-- 
    <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700 dark:text-gray-300">Other Tasks</h2>
        <p class="text-gray-600 dark:text-gray-400">
            Future tasks like database cleanup, log rotation, etc., will appear here.
        </p>
    </div>
    -->

    <!-- Tautulli Sync Card -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mb-6 border border-transparent dark:border-gray-700">
        <div class="flex items-center mb-4">
            <img src="{{ url_for('static', filename='logos/tautulli-light.png') }}" alt="Tautulli Logo" class="block dark:hidden h-8 w-auto mr-3">
            <img src="{{ url_for('static', filename='logos/tautulli-dark.png') }}" alt="Tautulli Logo" class="hidden dark:block h-8 w-auto mr-3">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">Tautulli Watch History</h2>
        </div>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
            Import watch history from Tautulli. The incremental sync fetches recent events, while the full import retrieves all historical data. Plex webhooks provide real-time updates automatically.
        </p>

        <div class="space-y-3">
            <!-- Incremental Sync -->
            <form action="{{ url_for('admin.sync_tautulli') }}" method="POST">
                <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-opacity-50 transform transition-all duration-200 ease-in-out flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0015.357 2M9 15h4.581" />
                    </svg>
                    Incremental Sync (Recent Events)
                </button>
            </form>

            <!-- Full Import -->
            <form action="{{ url_for('admin.sync_tautulli', full='true') }}" method="POST">
                <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-opacity-50 transform transition-all duration-200 ease-in-out flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                    Full Import (All History)
                </button>
            </form>

            <!-- Wipe and Import (Fresh Start) -->
            <form action="{{ url_for('admin.tautulli_wipe_and_import') }}" method="POST"
                  onsubmit="return confirm('âš ï¸ This will DELETE all existing watch history and import fresh data from Tautulli. This cannot be undone. Continue?');">
                <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transform transition-all duration-200 ease-in-out flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Wipe & Fresh Import (Reset)
                </button>
            </form>

            <!-- Process Watch Status -->
            <form action="{{ url_for('admin.process_watch_status') }}" method="POST">
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transform transition-all duration-200 ease-in-out flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Process Watch Indicators
                </button>
            </form>
        </div>

        <div class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
            <p class="text-sm text-blue-800 dark:text-blue-300">
                <strong>ðŸ’¡ Tip:</strong> After importing history from Tautulli, use "Process Watch Indicators" to mark episodes as watched based on your history. This scans all watch events and updates episode checkboxes on show pages. Run this after any Tautulli import to backfill watch status.
            </p>
        </div>
    </div>

    <!-- Subtitle Processing Card -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mb-6 border border-transparent dark:border-gray-700">
      <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Subtitle Processing</h3>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
        Scan the configured subtitle directory (e.g., 'bazarr_subtitles'), parse .srt files, and import them into the database.
        This allows subtitles to be searchable and used for other features. This process might take some time depending on the number of subtitle files.
      </p>
      <form method="post" action="{{ url_for('admin.parse_all_subtitles_route') }}">
        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transform transition-all duration-200 ease-in-out flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z" />
            </svg>
          Parse All Subtitles
        </button>
      </form>
    </div>

</div>
{% endblock admin_page_content %}
