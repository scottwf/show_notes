{% extends "layout.html" %}

{% block page_title %}{{ character.character_name if character else character_name }} - Character Detail{% endblock %}
{% block title %}{{ character.character_name if character else character_name }} - Character Detail{% endblock %}

{% block content %}
<div class="container mx-auto px-2 sm:px-4 py-6 sm:py-8">
    <div class="mb-4">
        <a href="{{ url_for('main.episode_detail', tmdb_id=show_id, season_number=season_number, episode_number=episode_number) }}"
           class="text-sky-500 hover:text-sky-700 dark:text-sky-400 dark:hover:text-sky-300 transition-colors duration-150 text-sm sm:text-base">
            &larr; Back to Episode
        </a>
    </div>

    <!-- Character Header -->
    <div class="bg-white dark:bg-slate-800 shadow-xl rounded-lg overflow-hidden p-6 flex flex-col md:flex-row items-start gap-6 mb-6">
        <div class="flex-shrink-0">
            <img src="{{ character.actor_thumb if character.actor_thumb else url_for('static', filename='logos/placeholder_poster.png') }}"
                 alt="{{ character.actor_name if character.actor_name else 'Unknown' }}"
                 class="w-32 h-32 rounded-full object-cover border border-slate-200 dark:border-slate-600">
        </div>
        <div class="flex-1 min-w-0">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">{{ character.character_name if character else 'Unknown Character' }}</h1>
            <div class="text-lg text-gray-600 dark:text-gray-300 mb-2">
                Played by <span class="font-semibold">{{ character.actor_name if character.actor_name else 'Unknown' }}</span>
            </div>
            <div class="mb-4">
                <span class="inline-block bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded px-3 py-1 text-xs font-medium mr-2">
                    {{ show_title }}
                </span>
                <span class="inline-block bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded px-3 py-1 text-xs font-medium mr-2">
                    Season {{ season_number }}
                </span>
                <span class="inline-block bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded px-3 py-1 text-xs font-medium">
                    Episode {{ episode_number }}
                </span>
            </div>
        </div>
    </div>

    <!-- Episodes This Character Appears In -->
    <div class="bg-white dark:bg-slate-800 shadow-xl rounded-lg overflow-hidden p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Episodes in {{ show_title }}</h2>
        {% if character_episodes %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for ep in character_episodes %}
                <a href="{{ url_for('main.episode_detail', tmdb_id=show_id, season_number=ep.season_number, episode_number=ep.episode_number) }}"
                   class="block bg-slate-50 dark:bg-slate-700 rounded-lg p-4 hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">
                    <div class="font-semibold text-gray-900 dark:text-white">
                        S{{ "%02d" % ep.season_number }}E{{ "%02d" % ep.episode_number }}
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-300">
                        {{ ep.title if ep.title else 'Episode ' + ep.episode_number|string }}
                    </div>
                    {% if ep.air_date_utc %}
                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                        {{ ep.air_date_utc | format_datetime('%B %d, %Y') }}
                    </div>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-gray-500 dark:text-gray-400">No episode information available.</p>
        {% endif %}
    </div>

    <!-- Other Shows This Actor Appears In -->
    {% if other_shows %}
    <div class="bg-white dark:bg-slate-800 shadow-xl rounded-lg overflow-hidden p-6">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
            Other Shows Featuring {{ character.actor_name }}
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% for show in other_shows %}
            <a href="{{ url_for('main.show_detail', tmdb_id=show.tmdb_id) }}"
               class="block bg-slate-50 dark:bg-slate-700 rounded-lg p-4 hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">
                <div class="font-semibold text-gray-900 dark:text-white">
                    {{ show.title }}
                </div>
                <div class="text-sm text-gray-600 dark:text-gray-300">
                    as {{ show.character_name }}
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    {{ show.episode_count }} episode{{ 's' if show.episode_count != 1 else '' }}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
