{% extends "admin_layout.html" %}

{% block admin_page_title %}Service Settings{% endblock %}

{% block admin_extra_js %}
<script src="{{ url_for('static', filename='admin_settings.js') }}?v=3"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tab switching
  const tabButtons = document.querySelectorAll('[data-tab]');
  const tabPanels = document.querySelectorAll('[data-panel]');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
      const targetPanel = button.dataset.tab;
      
      // Update button states
      tabButtons.forEach(btn => {
        btn.classList.remove('border-sky-500', 'text-sky-600', 'dark:text-sky-400', 'dark:border-sky-400');
        btn.classList.add('border-transparent', 'text-slate-500', 'dark:text-slate-400');
      });
      button.classList.remove('border-transparent', 'text-slate-500', 'dark:text-slate-400');
      button.classList.add('border-sky-500', 'text-sky-600', 'dark:text-sky-400', 'dark:border-sky-400');
      
      // Update panel visibility
      tabPanels.forEach(panel => {
        panel.classList.add('hidden');
      });
      document.querySelector(`[data-panel="${targetPanel}"]`).classList.remove('hidden');
    });
  });
});
</script>
{% endblock %}

{% block admin_page_header %}Service Configuration{% endblock %}

{% block admin_page_content %}
<div class="max-w-7xl mx-auto px-4">
  <!-- Quick Actions Bar -->
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 mb-6">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">Quick Sync Actions</h3>
    <div class="flex flex-wrap gap-2">
      <button type="button" onclick="syncService('sonarr')" class="inline-flex items-center px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Sync Sonarr
      </button>
      <button type="button" onclick="syncService('radarr')" class="inline-flex items-center px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Sync Radarr
      </button>
      <button type="button" onclick="syncService('tautulli')" class="inline-flex items-center px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Sync Tautulli
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="border-b border-slate-200 dark:border-slate-700 mb-6">
    <nav class="-mb-px flex space-x-8 overflow-x-auto" aria-label="Tabs">
      <button type="button" data-tab="plex" class="border-b-2 border-sky-500 text-sky-600 dark:text-sky-400 dark:border-sky-400 whitespace-nowrap py-4 px-1 font-medium text-sm">
        Plex
      </button>
      <button type="button" data-tab="notifications" class="border-b-2 border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 hover:border-slate-300 dark:hover:border-slate-600 whitespace-nowrap py-4 px-1 font-medium text-sm">
        Notifications
      </button>
      <button type="button" data-tab="media" class="border-b-2 border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 hover:border-slate-300 dark:hover:border-slate-600 whitespace-nowrap py-4 px-1 font-medium text-sm">
        Media Services
      </button>
      <button type="button" data-tab="requests" class="border-b-2 border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 hover:border-slate-300 dark:hover:border-slate-600 whitespace-nowrap py-4 px-1 font-medium text-sm">
        Requests
      </button>
      <button type="button" data-tab="subtitles" class="border-b-2 border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 hover:border-slate-300 dark:hover:border-slate-600 whitespace-nowrap py-4 px-1 font-medium text-sm">
        Subtitles
      </button>
      <button type="button" data-tab="ai" class="border-b-2 border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 hover:border-slate-300 dark:hover:border-slate-600 whitespace-nowrap py-4 px-1 font-medium text-sm">
        AI/LLM
      </button>
      <button type="button" data-tab="general" class="border-b-2 border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 hover:border-slate-300 dark:hover:border-slate-600 whitespace-nowrap py-4 px-1 font-medium text-sm">
        General
      </button>
    </nav>
  </div>

  <form method="post" class="space-y-6">
    <!-- Plex Panel -->
    <div data-panel="plex">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Plex OAuth -->
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
          <div class="flex items-center mb-4">
            <img src="{{ url_for('static', filename='logos/plex-light.png') }}" alt="Plex" class="w-8 h-8 mr-3 dark:hidden">
            <img src="{{ url_for('static', filename='logos/plex-dark.png') }}" alt="Plex" class="w-8 h-8 mr-3 hidden dark:inline">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">OAuth Authentication</h3>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">
            Use a unique Client ID for your app. No Plex registration required. 
            <a href="https://forums.plex.tv/t/authenticating-with-plex/609370" class="text-sky-600 dark:text-sky-400 underline" target="_blank">Learn more</a>
          </p>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Client ID</label>
            <input type="text" name="plex_client_id" value="{{ settings.plex_client_id or '' }}" 
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
        </div>

        <!-- Plex Webhook -->
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
          <div class="flex items-center mb-4">
            <svg class="w-8 h-8 mr-3 text-sky-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Webhook Integration</h3>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">Add this webhook URL to your Plex server settings:</p>
          <div class="bg-slate-100 dark:bg-slate-700 rounded p-3 mb-3 font-mono text-sm break-all border border-slate-200 dark:border-slate-600">
            {{ site_url }}/plex/webhook
          </div>
          <p class="text-xs text-slate-500 dark:text-slate-400">
            Settings → Webhooks → Add Webhook in your Plex Web App
          </p>
        </div>
      </div>
    </div>

    <!-- Notifications Panel -->
    <div data-panel="notifications" class="hidden">
      <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
        <div class="flex items-center mb-4">
          <img src="{{ url_for('static', filename='logos/pushover-light.png') }}" alt="Pushover" class="w-8 h-8 mr-3 dark:hidden">
          <img src="{{ url_for('static', filename='logos/pushover-dark.png') }}" alt="Pushover" class="w-8 h-8 mr-3 hidden dark:inline">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Pushover Notifications</h3>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Send notifications to your devices when events occur.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">API Token</label>
            <input type="text" name="pushover_token" value="{{ settings.pushover_token or '' }}"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
          <div>
            <div class="flex items-center justify-between mb-2">
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200">User Key</label>
              <a href="https://pushover.net/" target="_blank" class="text-xs text-sky-600 dark:text-sky-400 hover:underline">Get key</a>
            </div>
            <input type="text" name="pushover_key" value="{{ settings.pushover_key or '' }}"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
        </div>
        <button type="button" id="pushover-test-btn" class="mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm">
          Send Test Notification
        </button>
      </div>
    </div>

    <!-- Media Services Panel -->
    <div data-panel="media" class="hidden">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Tautulli -->
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
          <div class="flex items-center mb-4">
            <img src="{{ url_for('static', filename='logos/tautulli-light.png') }}" alt="Tautulli" class="w-8 h-8 mr-3 dark:hidden">
            <img src="{{ url_for('static', filename='logos/tautulli-dark.png') }}" alt="Tautulli" class="w-8 h-8 mr-3 hidden dark:inline">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Tautulli</h3>
            <span id="tautulli_status_dot" class="ml-auto {% if tautulli_status %}text-green-500{% else %}text-red-500{% endif %}" title="{% if tautulli_status %}Connected{% else %}Not Connected{% endif %}">●</span>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Plex media server statistics and watch history.</p>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">URL</label>
              <input type="text" name="tautulli_url" value="{{ settings.tautulli_url or '' }}"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">API Key</label>
              <input type="text" name="tautulli_api_key" value="{{ settings.tautulli_api_key or '' }}"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
          </div>
          <button type="button" data-service="tautulli" class="test-btn mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm">
            Test Connection
          </button>
        </div>

        <!-- Sonarr -->
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
          <div class="flex items-center mb-4">
            <img src="{{ url_for('static', filename='logos/sonarr-light.png') }}" alt="Sonarr" class="w-8 h-8 mr-3 dark:hidden">
            <img src="{{ url_for('static', filename='logos/sonarr-dark.png') }}" alt="Sonarr" class="w-8 h-8 mr-3 hidden dark:inline">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Sonarr</h3>
            <span id="sonarr_status_dot" class="ml-auto {% if sonarr_status %}text-green-500{% else %}text-red-500{% endif %}" title="{% if sonarr_status %}Connected{% else %}Not Connected{% endif %}">●</span>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">TV series library management.</p>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Local URL</label>
              <input type="text" name="sonarr_url" value="{{ settings.sonarr_url or '' }}"
                placeholder="http://192.168.1.x:8989"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Public URL</label>
              <input type="text" name="sonarr_remote_url" value="{{ settings.sonarr_remote_url or '' }}"
                placeholder="https://sonarr.example.com"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">API Key</label>
              <input type="text" name="sonarr_api_key" value="{{ settings.sonarr_api_key or '' }}"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
          </div>
          <button type="button" data-service="sonarr" class="test-btn mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm">
            Test Connection
          </button>
        </div>

        <!-- Radarr -->
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
          <div class="flex items-center mb-4">
            <img src="{{ url_for('static', filename='logos/radarr-light.png') }}" alt="Radarr" class="w-8 h-8 mr-3 dark:hidden">
            <img src="{{ url_for('static', filename='logos/radarr-dark.png') }}" alt="Radarr" class="w-8 h-8 mr-3 hidden dark:inline">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Radarr</h3>
            <span id="radarr_status_dot" class="ml-auto {% if radarr_status %}text-green-500{% else %}text-red-500{% endif %}" title="{% if radarr_status %}Connected{% else %}Not Connected{% endif %}">●</span>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Movie library management.</p>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Local URL</label>
              <input type="text" name="radarr_url" value="{{ settings.radarr_url or '' }}"
                placeholder="http://192.168.1.x:7878"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Public URL</label>
              <input type="text" name="radarr_remote_url" value="{{ settings.radarr_remote_url or '' }}"
                placeholder="https://radarr.example.com"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">API Key</label>
              <input type="text" name="radarr_api_key" value="{{ settings.radarr_api_key or '' }}"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            </div>
          </div>
          <button type="button" data-service="radarr" class="test-btn mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm">
            Test Connection
          </button>
        </div>
      </div>
    </div>

    <!-- Requests Panel -->
    <div data-panel="requests" class="hidden">
      <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
        <div class="flex items-center mb-4">
          <img src="{{ url_for('static', filename='logos/jellyseerr-light.png') }}" alt="Jellyseerr" class="w-8 h-8 mr-3 dark:hidden">
          <img src="{{ url_for('static', filename='logos/jellyseerr-dark.png') }}" alt="Jellyseerr" class="w-8 h-8 mr-3 hidden dark:inline">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Jellyseerr</h3>
          <span id="jellyseerr_status_dot" class="ml-auto {% if jellyseerr_status %}text-green-500{% else %}text-red-500{% endif %}" title="{% if jellyseerr_status %}Connected{% else %}Not Connected{% endif %}">●</span>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Media request management system.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Local URL</label>
            <input type="text" name="jellyseerr_url" value="{{ settings.jellyseerr_url or '' }}"
              placeholder="http://192.168.1.x:5055"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Public URL</label>
            <input type="text" name="jellyseerr_web_url" value="{{ settings.jellyseerr_web_url or '' }}"
              placeholder="https://requests.example.com"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">API Key</label>
            <input type="text" name="jellyseerr_api_key" value="{{ settings.jellyseerr_api_key or '' }}"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
        </div>
        <button type="button" data-service="jellyseerr" class="test-btn mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm">
          Test Connection
        </button>
      </div>
    </div>

    <!-- Subtitles Panel -->
    <div data-panel="subtitles" class="hidden">
      <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
        <div class="flex items-center mb-4">
          <img src="{{ url_for('static', filename='logos/bazarr-light.png') }}" alt="Bazarr" class="w-8 h-8 mr-3 dark:hidden">
          <img src="{{ url_for('static', filename='logos/bazarr-dark.png') }}" alt="Bazarr" class="w-8 h-8 mr-3 hidden dark:inline">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Bazarr</h3>
          <span id="bazarr_status_dot" class="ml-auto {% if bazarr_status %}text-green-500{% else %}text-red-500{% endif %}" title="{% if bazarr_status %}Connected{% else %}Not Connected{% endif %}">●</span>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Subtitle management for Sonarr and Radarr.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">URL</label>
            <input type="text" name="bazarr_url" value="{{ settings.bazarr_url or '' }}"
              placeholder="http://192.168.1.x:6767"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">API Key</label>
            <input type="text" name="bazarr_api_key" value="{{ settings.bazarr_api_key or '' }}"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          </div>
        </div>
        <button type="button" data-service="bazarr" class="test-btn mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm">
          Test Connection
        </button>
      </div>
    </div>

    <!-- AI/LLM Panel -->
    <div data-panel="ai" class="hidden">
      <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
        <div class="flex items-center mb-4">
          <svg class="w-8 h-8 mr-3 text-sky-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Ollama (LLM)</h3>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Local AI models for enhanced features.</p>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">API URL</label>
          <input type="text" name="ollama_api_url" value="{{ settings.ollama_api_url or '' }}"
            placeholder="http://192.168.1.x:11434"
            class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
        <button type="button" data-service="ollama" class="test-btn mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white text-sm font-medium rounded-md shadow-sm">
          Test Connection
        </button>
      </div>
    </div>

    <!-- General Panel -->
    <div data-panel="general" class="hidden">
      <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4">General Settings</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2">Timezone</label>
            <select name="timezone" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
              <option value="">Select timezone...</option>
              {% for tz in timezones %}
              <option value="{{ tz }}" {% if settings.timezone == tz %}selected{% endif %}>{{ tz }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="flex justify-end pt-6 border-t border-slate-200 dark:border-slate-700">
      <button type="submit" class="px-6 py-3 bg-sky-500 hover:bg-sky-600 text-white font-medium rounded-md shadow-sm transition-colors">
        Save All Settings
      </button>
    </div>
  </form>
</div>

<script>
function syncService(service) {
  const button = event.target;
  button.disabled = true;
  button.innerHTML = '<svg class="animate-spin w-4 h-4 mr-2 inline" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Syncing...';
  
  fetch(`/admin/sync_${service}_library`, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
      alert(data.message || `${service} sync started`);
      button.disabled = false;
      button.innerHTML = button.innerHTML.replace('Syncing...', `Sync ${service.charAt(0).toUpperCase() + service.slice(1)}`);
    })
    .catch(err => {
      alert(`Error: ${err.message}`);
      button.disabled = false;
      button.innerHTML = button.innerHTML.replace('Syncing...', `Sync ${service.charAt(0).toUpperCase() + service.slice(1)}`);
    });
}
</script>
{% endblock %}
