{% extends "admin_layout.html" %}

{% block admin_page_title %}Service Settings{% endblock %}

{% block admin_extra_js %}
<script src="{{ url_for('static', filename='admin_settings.js') }}?v=3"></script>
{% endblock %}

{% block admin_page_header %}Service Configuration{% endblock %}

{% block admin_page_content %}
<h2 class="text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100 mb-6 sm:mb-8 text-center">Admin & Service
  Settings</h2>
<form method="post" class="space-y-8 max-w-2xl mx-auto">
  <!-- Service Settings Group -->
  <!-- LLM Configuration -->


  <!-- Plex OAuth Settings -->
  <details
    class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600 shadow-lg rounded-lg p-4 sm:p-6 mb-8">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-12 h-12 sm:w-14 sm:h-14">
        <img src="{{ url_for('static', filename='logos/plex-light.png') }}" alt="Plex logo"
          class="w-full h-full object-contain dark:hidden">
        <img src="{{ url_for('static', filename='logos/plex-dark.png') }}" alt="Plex logo dark"
          class="w-full h-full object-contain hidden dark:inline">
      </span>
      <h3 class="text-xl font-bold text-yellow-700 dark:text-yellow-400">Plex OAuth Authentication</h3>
    </summary>
    <div class="mt-4">
      <div class="text-sm text-yellow-800 dark:text-yellow-300 mb-4">
        <p>Set up Plex OAuth to enable user authentication with Plex accounts. You do <strong>not</strong> need to
          register your app with Plex—just use a unique Client ID for your app. See <a
            href="https://forums.plex.tv/t/authenticating-with-plex/609370"
            class="text-sky-600 dark:text-sky-400 underline" target="_blank">Plex OAuth Guide</a> for details.</p>
      </div>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="plex_client_id">
            Plex Client ID
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400"
              title="Use any unique string (e.g. 'shownotes-app-1234'). This identifies your app to Plex.">(?)</span>
          </label>
          <input type="text" id="plex_client_id" name="plex_client_id" value="{{ settings.plex_client_id or '' }}"
            class="border-yellow-400 dark:border-yellow-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
        </div>
      </div>

      <!-- Plex Webhook Integration -->
      <div
        class="bg-amber-50 dark:bg-amber-900/30 border-l-4 border-amber-400 dark:border-amber-500 p-4 sm:p-6 mt-6 rounded-r-lg shadow-md">
        <div class="flex items-center mb-3">
          <svg class="w-6 h-6 text-amber-500 dark:text-amber-400 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M12 20h.01M21.75 12a9.75 9.75 0 11-19.5 0 9.75 9.75 0 0119.5 0z" />
          </svg>
          <h3 class="font-semibold text-xl text-amber-800 dark:text-amber-200">Plex Webhook Integration</h3>
        </div>
        <p class="text-amber-700 dark:text-amber-300 mb-4 text-sm">To enable Plex events in this app, you need to add a
          webhook in your Plex server settings. Follow these steps:</p>
        <ol class="list-decimal list-inside mb-4 text-amber-800 dark:text-amber-200 space-y-1 text-sm">
          <li>Open your <span class="font-semibold">Plex Web App</span> and sign in as an admin.</li>
          <li>Click the <span class="font-semibold">Settings</span> (wrench icon) in the top right.</li>
          <li>In the left sidebar, under <span class="font-semibold">Settings</span>, click <span
              class="font-semibold">Webhooks</span> (you may need to expand <span class="font-semibold">Advanced</span>
            to find it).</li>
          <li>Click <span class="font-semibold">Add Webhook</span>.</li>
          <li>Paste the following URL into the webhook URL field:</li>
        </ol>
        <div
          class="bg-slate-100 dark:bg-slate-800 border border-amber-300 dark:border-amber-600 rounded px-4 py-3 mb-4 text-sm font-mono text-slate-800 dark:text-slate-100 break-all">
          <span class="select-all bg-yellow-100 dark:bg-yellow-900/30 px-1 rounded">{{ site_url }}/plex/webhook</span>
        </div>
        <p class="text-amber-700 dark:text-amber-300 text-sm">Click <span class="font-semibold">Save</span>. Plex will
          now send event notifications to this app.</p>
        <p class="text-xs text-amber-600 dark:text-amber-400 mt-3">You can test the webhook by playing or pausing media
          in Plex and checking this app for activity.</p>
      </div>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          var btn = document.getElementById('gen-plex-secret');
          if (btn) {
            btn.addEventListener('click', function () {
              fetch('/admin/gen_plex_secret', { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                  document.getElementById('plex_client_secret').value = data.secret;
                });
            });
          }
        });
      </script>
    </div>
  </details>

  <!-- Pushover -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-12 h-12 sm:w-14 sm:h-14">
        <img src="{{ url_for('static', filename='logos/pushover-light.png') }}" alt="Pushover logo"
          class="w-full h-full object-contain dark:hidden">
        <img src="{{ url_for('static', filename='logos/pushover-dark.png') }}" alt="Pushover logo dark"
          class="w-full h-full object-contain hidden dark:inline">
      </span>
      <span class="font-semibold text-xl text-slate-800 dark:text-slate-100">Pushover</span>
      <span id="pushover_status" class="ml-auto text-sm text-slate-600 dark:text-slate-300"></span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-4">Pushover sends notifications to your device when
        important events occur.</p>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="pushover_token">API
            Token</label>
          <input type="text" id="pushover_token" name="pushover_token" value="{{ settings.pushover_token }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
        <div>
          <div class="flex items-center justify-between mb-1">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200" for="pushover_key">User
              Key</label>
            <a href="https://pushover.net/" target="_blank"
              class="text-sky-500 dark:text-sky-400 text-xs hover:underline">Get your key</a>
          </div>
          <input type="text" id="pushover_key" name="pushover_key" value="{{ settings.pushover_key }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
      </div>
      <button type="button" id="pushover-test-btn"
        class="bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-md shadow-sm mt-4 text-sm font-medium">Send Test
        Notification</button>
    </div>
  </details>

  <!-- Tautulli -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-12 h-12 sm:w-14 sm:h-14">
        {# Placeholder for Tautulli logo - assuming a tautulli.png might exist or be added later #}
        <img src="{{ url_for('static', filename='logos/tautulli-light.png') }}" alt="Tautulli logo"
          class="w-full h-full object-contain dark:hidden">
        <img src="{{ url_for('static', filename='logos/tautulli-dark.png') }}" alt="Tautulli logo dark"
          class="w-full h-full object-contain hidden dark:inline">
      </span>
      <span class="font-semibold text-xl text-slate-800 dark:text-slate-100">Tautulli</span>
      <span id="tautulli_status_dot"
        class="ml-2 {% if tautulli_status %}text-green-500{% else %}text-red-500{% endif %}"
        title="{% if tautulli_status %}Connected{% else %}Not Connected/Error{% endif %}">●</span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-4">Tautulli provides detailed Plex media server statistics
        and watch history.</p>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1"
            for="tautulli_url">URL</label>
          <input type="text" id="tautulli_url" name="tautulli_url" value="{{ settings.tautulli_url or '' }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="tautulli_api_key">API
            Key</label>
          <input type="text" id="tautulli_api_key" name="tautulli_api_key" value="{{ settings.tautulli_api_key or '' }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
      </div>
      <button type="button" data-service="tautulli"
        class="test-btn bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-md shadow-sm mt-4 text-sm font-medium">Test</button>
    </div>
  </details>

  <!-- Sonarr -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-10 h-10 sm:w-12 sm:h-12"> <!-- Adjusted size -->
        <img src="{{ url_for('static', filename='logos/sonarr-light.png') }}" alt="Sonarr logo"
          class="w-full h-full object-contain dark:hidden">
        <img src="{{ url_for('static', filename='logos/sonarr-dark.png') }}" alt="Sonarr logo dark"
          class="w-full h-full object-contain hidden dark:inline">
      </span>
      <span class="font-semibold text-lg sm:text-xl text-slate-800 dark:text-slate-100">Sonarr</span>
      <!-- Adjusted size -->
      <span id="sonarr_status_dot" class="ml-2 {% if sonarr_status %}text-green-500{% else %}text-red-500{% endif %}"
        title="{% if sonarr_status %}Connected{% else %}Not Connected/Error{% endif %}">●</span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-3">Manages TV show downloads and keeps your TV library up
        to date automatically.</p>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="sonarr_url">Local URL
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">(for API access)</span>
          </label>
          <input type="text" id="sonarr_url" name="sonarr_url" value="{{ settings.sonarr_url }}"
            placeholder="http://192.168.1.10:8989"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="sonarr_remote_url">Remote URL
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">(for clickable links)</span>
          </label>
          <input type="text" id="sonarr_remote_url" name="sonarr_remote_url" value="{{ settings.sonarr_remote_url or '' }}"
            placeholder="https://admin.chitekmedia.club/sonarr"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Optional: External URL for accessing Sonarr from anywhere (used in notifications)</p>
        </div>
        <div>
          <div class="flex items-center justify-between mb-1">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200" for="sonarr_api_key">API
              Key</label>
            <a id="sonarr_key_link"
              href="{{ settings.sonarr_url.rstrip('/') if settings.sonarr_url else '#' }}/settings/general"
              target="_blank" class="text-sky-500 dark:text-sky-400 text-xs hover:underline">Get API Key</a>
          </div>
          <input type="text" id="sonarr_api_key" name="sonarr_api_key" value="{{ settings.sonarr_api_key }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
      </div>
      <button type="button" data-service="sonarr"
        class="test-btn bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-md shadow-sm mt-4 text-sm font-medium">Test</button>

      <!-- Sonarr Webhook Integration -->
      <div
        class="bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400 dark:border-blue-500 p-4 sm:p-6 mt-6 rounded-r-lg shadow-md">
        <div class="flex items-center mb-3">
          <svg class="w-6 h-6 text-blue-500 dark:text-blue-400 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M12 20h.01M21.75 12a9.75 9.75 0 11-19.5 0 9.75 9.75 0 0119.5 0z" />
          </svg>
          <h3 class="font-semibold text-xl text-blue-800 dark:text-blue-200">Sonarr Webhook Integration</h3>
        </div>
        <p class="text-blue-700 dark:text-blue-300 mb-4 text-sm">To enable automatic library syncing when Sonarr adds or
          updates content, add a webhook in your Sonarr settings:</p>
        <ol class="list-decimal list-inside mb-4 text-blue-800 dark:text-blue-200 space-y-1 text-sm">
          <li>Open your <span class="font-semibold">Sonarr Web Interface</span>.</li>
          <li>Go to <span class="font-semibold">Settings</span> → <span class="font-semibold">Connect</span>.</li>
          <li>Click the <span class="font-semibold">+</span> button to add a new connection.</li>
          <li>Select <span class="font-semibold">Webhook</span> from the list.</li>
          <li>Set the following configuration:</li>
        </ol>
        <div
          class="bg-slate-100 dark:bg-slate-800 border border-blue-300 dark:border-blue-600 rounded px-4 py-3 mb-4 text-sm font-mono text-slate-800 dark:text-slate-100 break-all">
          <strong>Name:</strong> ShowNotes<br>
          <strong>URL:</strong> <span class="select-all bg-yellow-100 dark:bg-yellow-900/30 px-1 rounded">{{
            sonarr_webhook_url }}</span><br>
          <strong>Method:</strong> POST (not PUT)<br>
          <strong>Username:</strong> (leave empty)<br>
          <strong>Password:</strong> (leave empty)<br>
          <strong>On Download:</strong> ✓<br>
          <strong>On Series Delete:</strong> ✓<br>
          <strong>On Episode File Delete:</strong> ✓<br>
          <strong>On Episode File Delete For Upgrade:</strong> ✓<br>
          <strong>On Rename:</strong> ✓<br>
          <strong>On Health:</strong> ✓ (optional, for periodic syncs)
        </div>
        <p class="text-blue-700 dark:text-blue-300 text-sm">Click <span class="font-semibold">Save</span>. Sonarr will
          now automatically sync your library when content changes.</p>
        <p class="text-xs text-blue-600 dark:text-blue-400 mt-3">This eliminates the need for manual library syncing
          from the Tasks page.</p>
      </div>
    </div>
  </details>

  <!-- Radarr -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-10 h-10 sm:w-12 sm:h-12"> <!-- Adjusted size -->
        <img src="{{ url_for('static', filename='logos/radarr-light.png') }}" alt="Radarr logo"
          class="w-full h-full object-contain dark:hidden">
        <img src="{{ url_for('static', filename='logos/radarr-dark.png') }}" alt="Radarr logo dark"
          class="w-full h-full object-contain hidden dark:inline">
      </span>
      <span class="font-semibold text-lg sm:text-xl text-slate-800 dark:text-slate-100">Radarr</span>
      <!-- Adjusted size -->
      <span id="radarr_status_dot" class="ml-2 {% if radarr_status %}text-green-500{% else %}text-red-500{% endif %}"
        title="{% if radarr_status %}Connected{% else %}Not Connected/Error{% endif %}">●</span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-3">Manages movie downloads and organizes your movie
        library automatically.</p>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="radarr_url">Local URL
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">(for API access)</span>
          </label>
          <input type="text" id="radarr_url" name="radarr_url" value="{{ settings.radarr_url }}"
            placeholder="http://192.168.1.10:7878"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="radarr_remote_url">Remote URL
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">(for clickable links)</span>
          </label>
          <input type="text" id="radarr_remote_url" name="radarr_remote_url" value="{{ settings.radarr_remote_url or '' }}"
            placeholder="https://admin.chitekmedia.club/radarr"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Optional: External URL for accessing Radarr from anywhere (used in notifications)</p>
        </div>
        <div>
          <div class="flex items-center justify-between mb-1">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200" for="radarr_api_key">API
              Key</label>
            <a id="radarr_key_link"
              href="{{ settings.radarr_url.rstrip('/') if settings.radarr_url else '#' }}/settings/general"
              target="_blank" class="text-sky-500 dark:text-sky-400 text-xs hover:underline">Get API Key</a>
          </div>
          <input type="text" id="radarr_api_key" name="radarr_api_key" value="{{ settings.radarr_api_key }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
      </div>
      <button type="button" data-service="radarr"
        class="test-btn bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-md shadow-sm mt-4 text-sm font-medium">Test</button>

      <!-- Radarr Webhook Integration -->
      <div
        class="bg-green-50 dark:bg-green-900/30 border-l-4 border-green-400 dark:border-green-500 p-4 sm:p-6 mt-6 rounded-r-lg shadow-md">
        <div class="flex items-center mb-3">
          <svg class="w-6 h-6 text-green-500 dark:text-green-400 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M12 20h.01M21.75 12a9.75 9.75 0 11-19.5 0 9.75 9.75 0 0119.5 0z" />
          </svg>
          <h3 class="font-semibold text-xl text-green-800 dark:text-green-200">Radarr Webhook Integration</h3>
        </div>
        <p class="text-green-700 dark:text-green-300 mb-4 text-sm">To enable automatic library syncing when Radarr adds
          or updates content, add a webhook in your Radarr settings:</p>
        <ol class="list-decimal list-inside mb-4 text-green-800 dark:text-green-200 space-y-1 text-sm">
          <li>Open your <span class="font-semibold">Radarr Web Interface</span>.</li>
          <li>Go to <span class="font-semibold">Settings</span> → <span class="font-semibold">Connect</span>.</li>
          <li>Click the <span class="font-semibold">+</span> button to add a new connection.</li>
          <li>Select <span class="font-semibold">Webhook</span> from the list.</li>
          <li>Set the following configuration:</li>
        </ol>
        <div
          class="bg-slate-100 dark:bg-slate-800 border border-green-300 dark:border-green-600 rounded px-4 py-3 mb-4 text-sm font-mono text-slate-800 dark:text-slate-100 break-all">
          <strong>Name:</strong> ShowNotes<br>
          <strong>URL:</strong> <span class="select-all bg-yellow-100 dark:bg-yellow-900/30 px-1 rounded">{{
            radarr_webhook_url }}</span><br>
          <strong>Method:</strong> POST (not PUT)<br>
          <strong>Username:</strong> (leave empty)<br>
          <strong>Password:</strong> (leave empty)<br>
          <strong>On Download:</strong> ✓<br>
          <strong>On Movie Delete:</strong> ✓<br>
          <strong>On Movie File Delete:</strong> ✓<br>
          <strong>On Movie File Delete For Upgrade:</strong> ✓<br>
          <strong>On Rename:</strong> ✓<br>
          <strong>On Health:</strong> ✓ (optional, for periodic syncs)
        </div>
        <p class="text-green-700 dark:text-green-300 text-sm">Click <span class="font-semibold">Save</span>. Radarr will
          now automatically sync your library when content changes.</p>
        <p class="text-xs text-green-600 dark:text-green-400 mt-3">This eliminates the need for manual library syncing
          from the Tasks page.</p>
      </div>
    </div>
  </details>

  <!-- Bazarr -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-10 h-10 sm:w-12 sm:h-12"> <!-- Adjusted size -->
        <img src="{{ url_for('static', filename='logos/bazarr-light.png') }}" alt="Bazarr logo"
          class="w-full h-full object-contain dark:hidden">
        <img src="{{ url_for('static', filename='logos/bazarr-dark.png') }}" alt="Bazarr logo dark"
          class="w-full h-full object-contain hidden dark:inline">
      </span>
      <span class="font-semibold text-lg sm:text-xl text-slate-800 dark:text-slate-100">Bazarr</span>
      <!-- Adjusted size -->
      <span id="bazarr_status_dot" class="ml-2 {% if bazarr_status %}text-green-500{% else %}text-red-500{% endif %}"
        title="{% if bazarr_status %}Connected{% else %}Not Connected/Error{% endif %}">●</span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-3">Adds and manages subtitles for your movies and TV shows
        automatically.</p>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="bazarr_url">URL</label>
          <input type="text" id="bazarr_url" name="bazarr_url" value="{{ settings.bazarr_url }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
        <div>
          <div class="flex items-center justify-between mb-1">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200" for="bazarr_api_key">API
              Key</label>
            <a id="bazarr_key_link"
              href="{{ settings.bazarr_url.rstrip('/') if settings.bazarr_url else '#' }}/settings" target="_blank"
              class="text-sky-500 dark:text-sky-400 text-xs hover:underline">Get API Key</a>
          </div>
          <input type="text" id="bazarr_api_key" name="bazarr_api_key" value="{{ settings.bazarr_api_key }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
        </div>
      </div>
      <button type="button" data-service="bazarr"
        class="test-btn bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-md shadow-sm mt-4 text-sm font-medium">Test</button>
    </div>
  </details>

  <!-- Jellyseerr -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-10 h-10 sm:w-12 sm:h-12">
        <svg class="w-full h-full text-purple-500 dark:text-purple-400" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </span>
      <span class="font-semibold text-lg sm:text-xl text-slate-800 dark:text-slate-100">Jellyseerr</span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-3">Jellyseerr (or Overseerr) allows users to request new content for your media library.</p>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="jellyseer_url">
            URL
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">(e.g., http://localhost:5055)</span>
          </label>
          <input type="text" id="jellyseer_url" name="jellyseer_url" value="{{ settings.jellyseer_url or '' }}"
            placeholder="http://localhost:5055"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Local network URL for API access</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="jellyseer_remote_url">
            Remote URL (Optional)
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">(e.g., https://jellyseerr.yourdomain.com)</span>
          </label>
          <input type="text" id="jellyseer_remote_url" name="jellyseer_remote_url" value="{{ settings.jellyseer_remote_url or '' }}"
            placeholder="https://jellyseerr.yourdomain.com"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">External URL for user "Request on Jellyseerr" links (via reverse proxy)</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="jellyseer_api_key">
            API Key
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">(for season request integration)</span>
          </label>
          <input type="text" id="jellyseer_api_key" name="jellyseer_api_key" value="{{ settings.jellyseer_api_key or '' }}"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Required for "Request Season" buttons. Find this in Jellyseerr Settings → General</p>
        </div>
      </div>
    </div>
  </details>

  <!-- TheTVDB -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-10 h-10 sm:w-12 sm:h-12">
        <img src="{{ url_for('static', filename='logos/tvdb-light.png') }}" alt="TheTVDB logo"
          class="w-full h-full object-contain dark:hidden">
        <img src="{{ url_for('static', filename='logos/tvdb-dark.png') }}" alt="TheTVDB logo dark"
          class="w-full h-full object-contain hidden dark:inline">
      </span>
      <span class="font-semibold text-lg sm:text-xl text-slate-800 dark:text-slate-100">TheTVDB</span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-3">Fetches cast, role-specific images, and episode
        metadata from <a href='https://thetvdb.com/' target='_blank'
          class='text-sky-500 dark:text-sky-400 underline'>TheTVDB</a>. <a href='https://thetvdb.github.io/v4-api/'
          target='_blank' class='text-sky-500 dark:text-sky-400 underline'>API Docs</a></p>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="thetvdb_api_key">API
            Key</label>
          <div class="relative flex items-center">
            <input type="password" id="thetvdb_api_key" name="thetvdb_api_key"
              value="{{ settings.thetvdb_api_key or '' }}" autocomplete="off"
              class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 pr-16">
            <button type="button"
              onclick="const inp = document.getElementById('thetvdb_api_key'); inp.type = inp.type === 'password' ? 'text' : 'password'; this.innerText = inp.type === 'password' ? 'Show' : 'Hide';"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-sky-600 dark:text-sky-400 focus:outline-none">Show</button>
          </div>
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Your API key for TheTVDB v4 API. <a
              href='https://thetvdb.com/api-information' target='_blank'
              class='text-sky-500 dark:text-sky-400 underline'>Get your key</a>.</p>
        </div>
      </div>
    </div>
  </details>

  <!-- Application Settings -->
  <details class="bg-slate-100 dark:bg-slate-800 shadow-lg rounded-lg p-4 sm:p-6">
    <summary class="flex items-center gap-x-3 cursor-pointer">
      <span class="inline-block w-12 h-12 sm:w-14 sm:h-14 flex items-center justify-center">
        <svg class="w-8 h-8 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </span>
      <span class="font-semibold text-xl text-slate-800 dark:text-slate-100">Application Settings</span>
    </summary>
    <div class="mt-4">
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-4">Configure general application preferences.</p>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1" for="timezone">
            Timezone
            <span class="ml-1 text-xs text-slate-500 dark:text-slate-400"
              title="Select your local timezone for displaying watch history timestamps">(?)</span>
          </label>
          <select id="timezone" name="timezone"
            class="border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-50 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
            <option value="UTC" {% if settings.timezone == 'UTC' %}selected{% endif %}>UTC</option>
            <optgroup label="North America">
              <option value="America/St_Johns" {% if settings.timezone == 'America/St_Johns' %}selected{% endif %}>Newfoundland Time (NST/NDT)</option>
              <option value="America/Halifax" {% if settings.timezone == 'America/Halifax' %}selected{% endif %}>Atlantic Time (AST/ADT)</option>
              <option value="America/New_York" {% if settings.timezone == 'America/New_York' %}selected{% endif %}>Eastern Time (EST/EDT)</option>
              <option value="America/Chicago" {% if settings.timezone == 'America/Chicago' %}selected{% endif %}>Central Time (CST/CDT)</option>
              <option value="America/Denver" {% if settings.timezone == 'America/Denver' %}selected{% endif %}>Mountain Time (MST/MDT)</option>
              <option value="America/Phoenix" {% if settings.timezone == 'America/Phoenix' %}selected{% endif %}>Arizona (MST - no DST)</option>
              <option value="America/Regina" {% if settings.timezone == 'America/Regina' %}selected{% endif %}>Saskatchewan (CST - no DST)</option>
              <option value="America/Los_Angeles" {% if settings.timezone == 'America/Los_Angeles' %}selected{% endif %}>Pacific Time (PST/PDT)</option>
              <option value="America/Anchorage" {% if settings.timezone == 'America/Anchorage' %}selected{% endif %}>Alaska Time (AKST/AKDT)</option>
              <option value="Pacific/Honolulu" {% if settings.timezone == 'Pacific/Honolulu' %}selected{% endif %}>Hawaii Time (HST - no DST)</option>
            </optgroup>
            <optgroup label="Europe">
              <option value="Europe/London" {% if settings.timezone == 'Europe/London' %}selected{% endif %}>London (GMT/BST)</option>
              <option value="Europe/Paris" {% if settings.timezone == 'Europe/Paris' %}selected{% endif %}>Paris (CET/CEST)</option>
              <option value="Europe/Berlin" {% if settings.timezone == 'Europe/Berlin' %}selected{% endif %}>Berlin (CET/CEST)</option>
              <option value="Europe/Athens" {% if settings.timezone == 'Europe/Athens' %}selected{% endif %}>Athens (EET/EEST)</option>
              <option value="Europe/Moscow" {% if settings.timezone == 'Europe/Moscow' %}selected{% endif %}>Moscow (MSK)</option>
            </optgroup>
            <optgroup label="Asia">
              <option value="Asia/Dubai" {% if settings.timezone == 'Asia/Dubai' %}selected{% endif %}>Dubai (GST)</option>
              <option value="Asia/Kolkata" {% if settings.timezone == 'Asia/Kolkata' %}selected{% endif %}>India (IST)</option>
              <option value="Asia/Shanghai" {% if settings.timezone == 'Asia/Shanghai' %}selected{% endif %}>China (CST)</option>
              <option value="Asia/Tokyo" {% if settings.timezone == 'Asia/Tokyo' %}selected{% endif %}>Japan (JST)</option>
              <option value="Asia/Seoul" {% if settings.timezone == 'Asia/Seoul' %}selected{% endif %}>South Korea (KST)</option>
            </optgroup>
            <optgroup label="Australia">
              <option value="Australia/Perth" {% if settings.timezone == 'Australia/Perth' %}selected{% endif %}>Perth (AWST)</option>
              <option value="Australia/Adelaide" {% if settings.timezone == 'Australia/Adelaide' %}selected{% endif %}>Adelaide (ACST/ACDT)</option>
              <option value="Australia/Brisbane" {% if settings.timezone == 'Australia/Brisbane' %}selected{% endif %}>Brisbane (AEST - no DST)</option>
              <option value="Australia/Sydney" {% if settings.timezone == 'Australia/Sydney' %}selected{% endif %}>Sydney (AEST/AEDT)</option>
            </optgroup>
            <optgroup label="Other">
              <option value="Pacific/Auckland" {% if settings.timezone == 'Pacific/Auckland' %}selected{% endif %}>Auckland (NZST/NZDT)</option>
              <option value="America/Sao_Paulo" {% if settings.timezone == 'America/Sao_Paulo' %}selected{% endif %}>São Paulo (BRT/BRST)</option>
              <option value="Africa/Johannesburg" {% if settings.timezone == 'Africa/Johannesburg' %}selected{% endif %}>Johannesburg (SAST)</option>
            </optgroup>
          </select>
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
            Watch history timestamps will be displayed in this timezone. 
            <strong>Note for Saskatchewan users:</strong> Select "Saskatchewan (CST - no DST)" to avoid daylight saving time adjustments.
          </p>
        </div>
      </div>
    </div>
  </details>

  <button type="submit"
    class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-all duration-150 ease-in-out text-base font-semibold mt-8 flex items-center justify-center">Save
    Changes</button>
</form>

<!-- Library Synchronization Section has been moved to Admin > Tasks -->

<script src="{{ url_for('static', filename='admin_settings.js') }}" defer></script>
{% endblock %}